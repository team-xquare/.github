name: Pr Open Comment
on:
  repository_dispatch:
    types: [ org-workflow-bot ]
  pull_request:
    types: [ opened, reopened ]

jobs:
  register:
    runs-on: ubuntu-latest
    steps:
    - uses: SvanBoxel/organization-workflow@main
      with:
        id: ${{ github.event.client_payload.id }}
        callback_url: ${{ github.event.client_payload.callback_url }}
        sha: ${{ github.event.client_payload.sha }}
        run_id: ${{ github.run_id }}
        name: ${{ github.workflow }}
  comment:
    needs: [register]
    runs-on: ubuntu-latest
    steps:
      - name: pr-number
        uses: 8BitJonny/gh-get-current-pr@2.1.1
        id: PR
        with:
          # Authetication token to access GitHub APIs. (Can be omitted by default.)
          github-token: ${{ github.token }}
          # Verbose setting SHA when using Pull_Request event trigger to fix #16. (For push even trigger this is not necessary.)
          sha: ${{ github.event.client_payload.sha }}
          # Only return if PR is still open. (By default it returns PRs in any state.)
          filterOutClosed: true
          # Only return if PR is not in draft state. (By default it returns PRs in any state.)
          filterOutDraft: true
      - run: echo "Your PR number is ${{ steps.PR.outputs.number }} and its JSON is ${{ steps.PR.outputs.pr }}"
      - name: check cient_payload
        env: 
          ISSUE_NUM: ${{ github.event.client_payload.event.issue.number }}
          PR_NUM: ${{ github.event.client_payload.event.pull_request.number }}
          REPO_NAME: ${{ github.event.client_payload.event.repository.full_name }}
        run: |
          echo "$REPO_NAME"
          echo "$ISSUE_NUM"
          echo "$PR_NUM"
      - name: Pn Rule Comment
        uses: actions/github-script@v5
        with:
          github-token: ${{secrets.GITHUB_TOKEN}}
          script: |
            github.rest.issues.createComment({
              issue_number: github.event.client_payload.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: 'P1: ê¼­ ë°˜ì˜í•´ì£¼ì„¸ìš” (Request changes)\n \
                     P2: ì ê·¹ì ìœ¼ë¡œ ê³ ë ¤í•´ì£¼ì„¸ìš” (Request changes)\n \
                     P3: ì›¬ë§Œí•˜ë©´ ë°˜ì˜í•´ ì£¼ì„¸ìš” (Comment)\n \
                     P4: ë°˜ì˜í•´ë„ ì¢‹ê³  ë„˜ì–´ê°€ë„ ì¢‹ìŠµë‹ˆë‹¤ (Approve)\n \
                     P5: ê·¸ëƒ¥ ì‚¬ì†Œí•œ ì˜ê²¬ì…ë‹ˆë‹¤ (Approve)\n \
                     ì§ˆë¬¸ì€ ê·¸ëƒ¥ ì½”ë©˜íŠ¸ë¡œ ğŸ˜ƒ'
            })
